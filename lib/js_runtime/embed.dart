const jsRuntimePolyfill = r'''// @bun
(()=>{function o(e){Object.assign(globalThis,e)}o({btoa:E,atob:R});function E(e){return T(e)}function R(e){return S(e)}function T(e){let n="",r=0;while(r<e.length){let s=e.charCodeAt(r++)&255,i=e.charCodeAt(r++),d=e.charCodeAt(r++),c=s>>2,a=(s&3)<<4|i>>4,f=isNaN(i)?64:(i&15)<<2|d>>6,x=isNaN(d)?64:d&63;n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(x)}return n}function S(e){let n="",r=0;e=e.replace(/[^A-Za-z0-9+/=]/g,"");while(r<e.length){let s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(r++)),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(r++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(r++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(r++)),a=s<<2|i>>4,f=(i&15)<<4|d>>2,x=(d&3)<<6|c;if(n+=String.fromCharCode(a),d!=64)n+=String.fromCharCode(f);if(c!=64)n+=String.fromCharCode(x)}return n}o({base64Encode:m,base64Decode:k});function m(e){let t=String.fromCharCode(...e);return E(t)}function k(e){let t=R(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}o({unscrambleImage:O});async function O(e,t,n){let r="unscrambleImage_"+Math.random().toString(36).slice(2),s="unscrambleImageResponse:"+r;return new Promise((i,d)=>{let c=(a)=>{if(removeEventListener(s,c),typeof a==="string")d(new Error(a));else i(a)};addEventListener(s,c),sendMessage("dart_rust_unscramble_image",JSON.stringify({id:r,imageData:m(e),blocks:t,autoTrim:n}))})}o({unscrambleImageColumns:$});async function $(e,t,n){let r="unscrambleImageColumns_"+Math.random().toString(36).slice(2),s="unscrambleImageColumnsResponse:"+r;return new Promise((i,d)=>{let c=(a)=>{if(removeEventListener(s,c),typeof a==="string")d(new Error(a));else i(a)};addEventListener(s,c),sendMessage("dart_rust_unscramble_image_columns",JSON.stringify({id:r,imageData:m(e),blocks:t,autoTrim:n}))})}o({unscrambleImageRows:v});async function v(e,t,n){let r="unscrambleImageRows_"+Math.random().toString(36).slice(2),s="unscrambleImageRowsResponse:"+r;return new Promise((i,d)=>{let c=(a)=>{if(removeEventListener(s,c),typeof a==="string")d(new Error(a));else i(a)};addEventListener(s,c),sendMessage("dart_rust_unscramble_image_rows",JSON.stringify({id:r,imageData:m(e),blocks:t,autoTrim:n}))})}var y=new Map;function w(e,t){let n=y.get(e);if(!n)n=new Set,y.set(e,n);n.add(t)}function A(e,t){y.get(e)?.delete(t)}function D(e,t){y.get(e)?.forEach((n)=>{try{n(t)}catch(r){console.error("Error in message listener for event:",e,r)}})}o({addEventListener:w,removeEventListener:A,__$$DART_SEND_MESSAGE$$__:D});if(!Array.prototype.at)Array.prototype.at=function(e){let t=this.length,n=Math.trunc(e)<0?t+e:e;return this[n]};if(!Array.prototype.findLast)Array.prototype.findLast=function(e){for(let t=this.length-1;t>=0;t--)if(e.call(this,this[t],t,this))return this[t];return};if(!Array.prototype.findLastIndex)Array.prototype.findLastIndex=function(e){for(let t=this.length-1;t>=0;t--)if(e.call(this,this[t],t,this))return t;return-1};if(!Array.prototype.toReversed)Array.prototype.toReversed=function(){return[...this].reverse()};if(!Array.prototype.toSorted)Array.prototype.toSorted=function(e){return[...this].sort(e)};if(!Array.prototype.toSpliced)Array.prototype.toSpliced=function(e,t,...n){let r=[...this];return r.splice(e,t,...n),r};if(!Array.prototype.with)Array.prototype.with=function(e,t){let n=[...this];return n[e]=t,n};if(!Set.prototype.union)Set.prototype.union=function(e){return new Set([...this,...e])};if(!Set.prototype.intersection)Set.prototype.intersection=function(e){return new Set([...this].filter((t)=>e.has(t)))};if(!Set.prototype.difference)Set.prototype.difference=function(e){return new Set([...this].filter((t)=>!e.has(t)))};if(!Set.prototype.symmetricDifference)Set.prototype.symmetricDifference=function(e){return new Set([...[...this].filter((t)=>!e.has(t)),...[...e].filter((t)=>!this.has(t))])};if(!Object.hasOwn)Object.hasOwn=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};if(!Promise.withResolvers)Promise.withResolvers=function(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:e,reject:t}};class h{map;constructor(e={}){if(this.map={},e instanceof h){e.forEach((t,n)=>{this.map[n.toLowerCase()]=t});return}else for(let t in e)this.map[t.toLowerCase()]=e[t]}get(e){return this.map[e.toLowerCase()]??null}has(e){return e.toLowerCase()in this.map}keys(){return Object.keys(this.map)}entries(){return Object.entries(this.map)}forEach(e){for(let[t,n]of this.entries())e(n,t,this)}toJSON(){return this.map}}o({Headers:h});class p{params=new Map;constructor(e){if(e.startsWith("?"))e=e.slice(1);for(let t of e.split("&")){if(!t)continue;let[n,r]=t.split("="),s=decodeURIComponent(n||""),i=decodeURIComponent(r||"");if(!this.params.has(s))this.params.set(s,[]);this.params.get(s).push(i)}}get(e){let t=this.params.get(e);return t?t[0]:null}getAll(e){return this.params.get(e)||[]}has(e){return this.params.has(e)}toJSON(){return this.params}toString(){let e=[];for(let[t,n]of this.params.entries())for(let r of n)e.push(`${encodeURIComponent(t)}=${encodeURIComponent(r)}`);return e.join("&")}}o({URLSearchParams:p});class u{href;origin;protocol;hostname;port;pathname;search;hash;searchParams;constructor(e,t){let n=P(e,t),r=N(n);this.href=n,this.origin=r.origin,this.protocol=r.protocol,this.hostname=r.hostname,this.port=r.port,this.pathname=r.pathname,this.search=r.search,this.hash=r.hash,this.searchParams=new p(this.search)}toString(){return this.href}toJSON(){return this.href}}o({URL:u});function P(e,t){if(!t||/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e))return e;if(t.endsWith("/"))return t+e;else return t.replace(/\/[^/]*$/,"/")+e}function N(e){let t=/^(?<protocol>[a-z]+:)?\/\/(?<hostname>[^:/?#]+)?(?::(?<port>\d+))?(?<pathname>[^?#]*)?(?<search>\?[^#]*)?(?<hash>#.*)?$/i,r=e.match(t)?.groups||{},s=r.protocol||"",i=r.hostname||"",d=r.port||"",c=r.pathname||"/",a=r.search||"",f=r.hash||"",x=s&&i?`${s}//${i}${d?":"+d:""}`:"";return{protocol:s,hostname:i,port:d,pathname:c,search:a,hash:f,origin:x}}class l{url;method;headers;body;constructor(e,t={}){this.url=typeof e==="string"?e:e instanceof u?e.toString():e.url,this.method=(t.method||(typeof e.method==="string"?e.method:"GET")).toUpperCase(),this.headers=new h(t.headers||(typeof e!=="string"&&!(e instanceof u)?e.headers:{})),this.body=t.body??(typeof e!=="string"&&!(e instanceof u)?e.body:null)}clone(){return new l(this.url,{method:this.method,headers:this.headers,body:this.body})}}o({Request:l});class b{#e;status;statusText;headers;url;ok;constructor(e,t={}){this.#e=e,this.status=t.status??200,this.statusText=t.statusText??"",this.headers=new h(t.headers||{}),this.url=t.url??"",this.ok=this.status>=200&&this.status<300}async text(){return new TextDecoder().decode(await this.arrayBuffer())}async json(){return JSON.parse(await this.text())}async arrayBuffer(){let e=atob(this.#e),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n.buffer}}o({Response:b});async function C(e,t){let n=e instanceof l?e:new l(e,t),r="fetch_"+Math.random().toString(36).slice(2),s="response:"+r;return new Promise((i,d)=>{let c=(a)=>{if(A(s,c),a.__fetch_error__)d(new Error(a?.__fetch_error__));else{let f=new b(a.__body,{status:a.status,statusText:a.statusText,headers:a.headers,url:a.url});i(f)}};w(s,c),sendMessage("dart_fetch_request",JSON.stringify({id:r,url:n.url,options:{method:n.method,headers:Object.fromEntries(n.headers.entries()),body:n.body}}))})}o({fetch:C});class I{constructor(e="utf-8"){if(e.toLowerCase()!=="utf-8")throw new Error("Only utf-8 TextDecoder is supported")}decode(e){if(!(e instanceof Uint8Array))e=new Uint8Array(e);let t="",n=0;while(n<e.length){let r=e[n++];if(r<128)t+=String.fromCharCode(r);else if(r>=192&&r<224){let s=e[n++];t+=String.fromCharCode((r&31)<<6|s&63)}else if(r>=224&&r<240){let s=e[n++],i=e[n++];t+=String.fromCharCode((r&15)<<12|(s&63)<<6|i&63)}else if(r>=240){let s=e[n++],i=e[n++],d=e[n++],c=(r&7)<<18|(s&63)<<12|(i&63)<<6|d&63;c-=65536,t+=String.fromCharCode(55296+(c>>10),56320+(c&1023))}}return t}}o({TextDecoder:I});class U{encode(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<128)t.push(r);else if(r<2048)t.push(192|r>>6),t.push(128|r&63);else if(r<55296||r>=57344)t.push(224|r>>12),t.push(128|r>>6&63),t.push(128|r&63);else{if(n++,n>=e.length)throw new Error("Invalid surrogate pair");let s=e.charCodeAt(n),i=(r-55296<<10)+(s-56320)+65536;t.push(240|i>>18),t.push(128|i>>12&63),t.push(128|i>>6&63),t.push(128|i&63)}}return new Uint8Array(t)}}o({TextEncoder:U});class _ extends Error{constructor(e){super(e);this.name="UnimplementedError"}}o({UnimplementedError:_});class g{static UNSENT=0;static OPENED=1;static HEADERS_RECEIVED=2;static LOADING=3;static DONE=4;readyState=g.UNSENT;status=0;statusText="";responseText="";responseType="";response=null;onreadystatechange=null;method="";url="";_async=!0;headers={};body=null;open(e,t,n=!0){this.method=e.toUpperCase(),this.url=t,this._async=n,this.readyState=g.OPENED,this._triggerReadyStateChange()}setRequestHeader(e,t){this.headers[e]=t}send(e=null){this.body=e;let t={method:this.method,headers:this.headers,body:e};C(this.url,t).then(async(n)=>{this.status=n.status,this.statusText=n.statusText,this.readyState=g.HEADERS_RECEIVED,this._triggerReadyStateChange(),this.readyState=g.LOADING,this._triggerReadyStateChange(),this.responseText=await n.text(),this.response=this.responseType==="json"?JSON.parse(this.responseText):this.responseText,this.readyState=g.DONE,this._triggerReadyStateChange()}).catch((n)=>{this.status=0,this.statusText=n.message,this.readyState=g.DONE,this._triggerReadyStateChange()})}abort(){this.status=0,this.statusText="abort",this.readyState=g.DONE,this._triggerReadyStateChange()}getAllResponseHeaders(){return""}getResponseHeader(e){return null}_triggerReadyStateChange(){if(typeof this.onreadystatechange==="function")try{this.onreadystatechange()}catch(e){console.error("Error in onreadystatechange:",e)}}}o({XMLHttpRequest:g});})();
''';
